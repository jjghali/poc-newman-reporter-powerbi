# This workflow will run tests using node and then publish a package to GitHub Packages when a release is created
# For more information see: https://help.github.com/actions/language-and-framework-guides/publishing-nodejs-packages

name: Promote Version

on:
  push:
    branch:
      - '*.*.*'
jobs:
  promote:
    name: Promoting to newer version
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-node@v1
        with:
          node-version: 12
      - run: npm version $
      - name: Setup GIT
        run: |
          git switch -c ${GITHUB_REF#refs/*/}
          git config user.email "$GITHUB_ACTOR@users.noreply.github.com"
          git config user.name "$GITHUB_ACTOR"
      - name: Set Release version
        run: |
          echo ::set-env name=RELEASE_VERSION::${GITHUB_REF#refs/*/}
          npm version ${{ env.RELEASE_VERSION }}          
          git commit -am "Upgrade package.json to ${{ env.RELEASE_VERSION }}"          
          git push     
  